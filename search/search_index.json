{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Homepage","text":""},{"location":"#summary","title":"Summary","text":"<p>ONES agents designed to run on SONiC powered devices to stream network state of the switches to Aviz collectors as well as 3rd party applications or collectors. This document describes how to integrate ONES agent with external collectors and sample clients to get streaming telemetry of device network state.</p>"},{"location":"#ones-agent","title":"ONES Agent","text":"<p>ONES is a lightweight that can be installed on SONiC devices which latch on to the SONiC architecture to collect the critical data on the node, maintaining the integrity of the data. These data points are exported to clients such as ONES collectors or 3rd party collectors using gNMI/gRPC techniques along with the OpenConfig path. This enables ONES to be Hardware agnostic allowing it to pull vital information from any ASIC running SONiC.</p>"},{"location":"GNMI/GNMI/","title":"GNMI","text":""},{"location":"GNMI/GNMI/#gnmi-clients","title":"GNMI Clients","text":"<p>Download and install <code>gnmic</code></p> <pre><code>To install run:\nbash -c \"$(curl -sL https://get-gnmic.openconfig.net)\"\nTo get the version run:\ngnmi_stuff$ gnmic version\nOutput:\nversion : 0.27.0\ncommit : cc5759c\ndate : 2022-10-10T06:40:26Z\ngitURL : https://github.com/openconfig/gnmic\ndocs : https://gnmic.openconfig.ne\n</code></pre>"},{"location":"GNMI/GNMI/#data-models","title":"Data Models","text":"<pre><code>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify\ncapabilities\ngNMI version: 1.1.0\nsupported models:\n- openconfig-bgp, OpenConfig working group, 6.1.1\n- openconfig-if-ethernet,, OpenConfig working group, 2.12.0\n- openconfig-lldp, OpenConfig working group, 0.2.1\n- openconfig-platform-fan, OpenConfig working group, 0.1.1\n- openconfig-platform-psu, OpenConfig working group, 0.2.1\n- openconfig-platform-transceiver, OpenConfig working group,\n0.8.0\n- system/processes, Aviz Networks Inc, 0.1.0\nsupported encodings:\n- PROTO\n</code></pre>"},{"location":"GNMI/GNMI_open_config/","title":"GNMI open config","text":""},{"location":"GNMI/GNMI_open_config/#gnmi-open-config-path-subscriptions","title":"GNMI Open Config Path Subscriptions","text":""},{"location":"GNMI/GNMI_open_config/#subscribe-to-system-resources","title":"Subscribe to System Resources","text":"<p>Subscribe to System Resources gnmic -a 10.4.4.61::50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path \u201c/system/processes/\u201c --stream-mode sample --sample-interval 10s --qos 0</p> <pre><code>{\n\"source\": \"10.4.4.61:50052\",\n\"subscription-name\": \"default-1679454364\",\n\"timestamp\": 1679454358297960118,\n\"time\": \"2023-03-21T20:05:58.297960118-07:00\",\n\"updates\": [\n{\n\"Path\": \"system/processes/process[pid=47]/state/pid\",\n\"values\": {\n\"system/processes/process/state/pid\": 47\n}\n},\n{\n\"Path\": \"system/processes/process[pid=47]/state/name\",\n\"values\": {\n\"system/processes/process/state/name\": \"ae6a64f24a2d|syncd\"\n}\n},\n{\n\"Path\": \"system/processes/process[pid=47]/state/cpu-utilization\",\n\"values\": {\n\"system/processes/process/state/cpu-utilization\": 7\n}\n},\n{\n\"Path\": \"system/processes/process[pid=47]/state/memory-usage\",\n\"values\": {\n\"system/processes/process/state/memory-usage\": 890241024\n}\n},\n{\n\"Path\": \"system/processes/process[pid=47]/state/memory-utilization\",\n\"values\": {\n\"system/processes/process/state/memory-utilization\": 5\n}\n},\n{\n\"Path\": \"system/processes/process[pid=12]/state/pid\",\n\"values\": {\n\"system/processes/process/state/pid\": 12\n}\n},\n\nUnset\n{\n\"Path\": \"system/processes/process[pid=12]/state/name\",\n\"values\": {\n\"system/processes/process/state/name\": \"cc982c3fba68|teamd\"\n}\n},\n{\n\"Path\": \"system/processes/process[pid=12]/state/cpu-utilization\",\n\"values\": {\n\"system/processes/process/state/cpu-utilization\": 0\n}\n},\n{\n\"Path\": \"system/processes/process[pid=12]/state/memory-usage\",\n\"values\": {\n\"system/processes/process/state/memory-usage\": 31572623\n}\n},\n{\n\"Path\": \"system/processes/process[pid=12]/state/memory-utilization\",\n\"values\": {\n\"system/processes/process/state/memory-utilization\": 0\n}\n},\n{\n\"Path\": \"system/processes/process[pid=41]/state/pid\",\n\"values\": {\n\"system/processes/process/state/pid\": 41\n}\n},\n</code></pre>"},{"location":"GNMI/GNMI_open_config/#subscribe-to-bgp-control-plane","title":"Subscribe to BGP control plane","text":"<p>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path \u201c/network-instances/\u201c --stream-mode sample --sample-interval 10s --qos 0</p> <pre><code>{\n\"source\": \"10.4.4.61:50052\",\n\"subscription-name\": \"default-1679454307\",\n\"timestamp\": 1679454302398028996,\n\"time\": \"2023-03-21T20:05:02.398028996-07:00\",\n\"updates\": [\n{\n\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/received/UPDATE\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/receiv\ned/UPDATE\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/sent/UPDATE\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/sent/\nUPDATE\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/received/NOTIFICATON\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/receiv\ned/NOTIFICATON\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/sent/NOTIFICATON\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/sent/\nNOTIFICATON\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/received/KEEPALIVE\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/receiv\ned/KEEPALIVE\": 0\n}\n},\n{\n\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/sent/KEEPALIVE\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/sent/\nKEEPALIVE\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/received/ROUTEREFRESH\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/receiv\ned/ROUTEREFRESH\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/messages/sent/ROUTEREFRESH\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/sent/\nROUTEREFRESH\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/established-transitions\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/established-transi\ntions\": 0\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/dropped-transitions\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/dropped-transitio\nns\": 0\n}\n},\n{\n\nUnset\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/local-as\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/local-as\":\n3003\n}\n},\n{\n\"Path\":\n\"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/nei\nghbors/neighbor[neighbor-address=20.0.0.33]/state/last-established\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/last-established\":\n0\n}\n},\n</code></pre>"},{"location":"GNMI/GNMI_open_config/#subscribe-to-lldp-neighbors","title":"Subscribe to LLDP neighbors","text":"<p>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path \u201c/lldp/interfaces/\u201c --stream-mode sample --sample-interval 10s --qos 0</p> <pre><code>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path\n\u201c/lldp/interfaces/\u201c --stream-mode sample --sample-interval 10s --qos 0\n\n{\n\"source\": \"10.4.4.61:50052\",\n\"subscription-name\": \"default-1679454247\",\n\"timestamp\": 1679454240385622169,\n\"time\": \"2023-03-21T20:04:00.385622169-07:00\",\n\"updates\": [\n{\n\"Path\": \"lldp/interfaces/interface[name=eth0]/neighbors/neighbor[name=1095]/state/system-name\",\n\"values\": {\n\"lldp/interfaces/interface/neighbors/neighbor/state/system-name\": \"sonic\"\n}\n},\n{\n\"Path\": \"lldp/interfaces/interface[name=eth0]/neighbors/neighbor[name=1095]/state/system-description\",\n\"values\": {\n\"lldp/interfaces/interface/neighbors/neighbor/state/system-description\": \"SONiC Software Version:\nSONiC.4.0.3-Enterprise_Base - HwSku: DellEMC-S5248f-P-25G-DPB - Distribution: Debian 10.13 - Kernel:\n4.19.0-9-2-amd64\"\n}\n\nUnset\n},\n{\n\"Path\": \"lldp/interfaces/interface[name=eth0]/neighbors/neighbor[name=1095]/state/chassis-id\",\n\"values\": {\n\"lldp/interfaces/interface/neighbors/neighbor/state/chassis-id\": \"0c:d5:48:a0:00:00\"\n}\n},\n{\n\"Path\": \"lldp/interfaces/interface[name=eth0]/neighbors/neighbor[name=1095]/state/chassis-id-type\",\n\"values\": {\n\"lldp/interfaces/interface/neighbors/neighbor/state/chassis-id-type\": \"MAC_ADDRESS\"\n}\n},\n{\n\"Path\": \"lldp/interfaces/interface[name=eth0]/neighbors/neighbor[name=1095]/state/id\",\n\"values\": {\n\"lldp/interfaces/interface/neighbors/neighbor/state/id\": \"1095\"\n}\n},\n{\n\"Path\": \"lldp/interfaces/interface[name=eth0]/neighbors/neighbor[name=1095]/state/port-id\",\n\"values\": {\n\"lldp/interfaces/interface/neighbors/neighbor/state/port-id\": \"eth0\"\n}\n},\n</code></pre>"},{"location":"GNMI/GNMI_open_config/#subscribe-to-device-interfaces","title":"Subscribe to Device Interfaces","text":"<p>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path \u201c/interfaces/interface/\u201c --stream-mode sample --sample-interval 10s --qos 0</p> <pre><code>{\n\"source\": \"10.4.4.61:50052\",\n\"subscription-name\": \"default-1679453426\",\n\"timestamp\": 1679453419863002971,\n\"time\": \"2023-03-21T19:50:19.863002971-07:00\",\n\"updates\": [\n{\n\"Path\": \"interfaces/interface[name=Ethernet212]/state/admin-status\",\n\"values\": {\n\"interfaces/interface/state/admin-status\": \"up\"\n}\n},\n\n{\n\"Path\": \"interfaces/interface[name=Ethernet212]/ethernet/state/port-speed\",\n\"values\": {\n\"interfaces/interface/ethernet/state/port-speed\": \"ETHERNET_SPEED::SPEED_100GB\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet212]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"down\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet212]/state/fec-mode\",\n\"values\": {\n\"interfaces/interface/state/fec-mode\": \"INTERFACE_FEC::FEC_DISABLED\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet212]/state/ifindex\",\n\"values\": {\n\"interfaces/interface/state/ifindex\": 27\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet212]/state/mtu\",\n\"values\": {\n\"interfaces/interface/state/mtu\": 9100\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet212]/state/lanes\",\n\"values\": {\n\"interfaces/interface/state/lanes\": \"221,222\"\n}\n},\n</code></pre>"},{"location":"GNMI/GNMI_open_config/#subscribe-to-platform-peripherals","title":"Subscribe to Platform Peripherals","text":"<p>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path \u201c/components/component/\u201c --stream-mode sample --sample-interval 10s --qos 0</p> <pre><code>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path \"components/component\"\n--stream-mode sample --sample-interval 100s --qos 0\n{\n\"source\": \"10.4.4.61:50052\",\n\"subscription-name\": \"default-1679453218\",\n\"timestamp\": 1679453211742825610,\n\"time\": \"2023-03-21T19:46:51.74282561-07:00\",\n\"updates\": [\n{\n\"Path\": \"components/component[name=FAN-2R]/state/removable\",\n\"values\": {\n\"components/component/state/removable\": true\n}\n},\n{\n\"Path\": \"components/component[name=FAN-2R]/state/oper-status\",\n\"values\": {\n\"components/component/state/oper-status\": \"COMPONENT_OPER_STATUS::ACTIVE\"\n}\n},\n{\n\"Path\": \"components/component[name=FAN-2R]/state/empty\",\n\"values\": {\n\"components/component/state/empty\": false\n}\n},\n</code></pre>"},{"location":"GNMI/GNMI_open_config/#subscribe-to-all-state-paths-together","title":"Subscribe to all state paths together","text":"<p>gnmic -a 10.4.4.61:50052 -u admin -p YourPaSsWoRd --skip-verify subscribe --path \"/components/component\" --path \"interfaces/interface\" --path \"network-instances\" --stream-mode sample --sample-interval 2s --qos 0</p>"},{"location":"GNMI/GNMI_open_config/#gnmi-gateway","title":"GNMI Gateway","text":"<p>ONES collector acts as GNMI gateway to discover the devices via targets.json file and supports hot reloading of the file so that any changes made to targets.json file will automatically reload new targets (devices) and subscription paths. This mechanism can be extended or used for any 3rd party gnmi gateways or collectors to discover and get streaming network state out of the devices. <code>Sample targets.json</code></p> <pre><code>{\n\"request\": {\n\"sonic\": {\n\"subscribe\": {\n\"prefix\": {},\n\"mode\": \"STREAM\",\n\"subscription\": [\n{\n\"path\": {\n\"elem\": [\n{\n\"name\": \"interfaces\"\n},\n{\n\"name\": \"interface\"\n}\n]\n},\n\"mode\": \"SAMPLE\",\n\"sample_interval\": 20000000000\n},\n{\n\"path\": {\n\"elem\": [\n{\n\"name\": \"lldp\"\n},\n{\n\"name\": \"interfaces\"\n}\n]\n},\n\"mode\": \"SAMPLE\",\n\"sample_interval\": 20000000000\n},\n{\n\"path\": {\n\"elem\": [\n{\n\"name\": \"components\"\n},\n{\n\"name\": \"component\"\n}\n]\n},\n\"mode\": \"SAMPLE\",\n\n\"sample_interval\": 20000000000\n},\n</code></pre>"},{"location":"GNMI/Metrics_Data/","title":"Metrics Data","text":""},{"location":"GNMI/Metrics_Data/#metrics-data","title":"Metrics Data","text":"Category Details Inventory Hardware: ASIC, HWSKU, Vendor, MAC, Serial, Part Number Platform: FAN/PSU (Model, Serial number) Ports: Speed, Breakout Transceiver: Type(Optics/DAC), Vendor Name/Serial/Date Platform/System Health PSU - Temperature, Voltage, Current, Power, LED status Fan - RPM, Direction, Drawers, LED status CPU Core Temperatures Transceivers: RX/TX Power, RX/TX Bias, Temperature, VCC control plane health Link Status BGP Nbrs, Connections, Prefixes Service Status Services - CPU/Memory Resource Utilization System CPU/Memory Layer 3 Routes - BGP/Kernel ASIC - Routes, ACLs Services - CPU/Memory Traffic Traffic. - In/Out PPS/BPS/% Traffic. - In/Out Errors/Discards Traffic. - In/Out Frame Size Traffic. - In/Out Queue Counter/Drops Topology Topology with Drill Down Platforms All Platforms supporting SONiC (NVIDIA,, Edgecore, Wistron, Arista, Cisco, Ragile, Celestica) NOS SONiC Community (201911 onwards), Vendor (EC SONIC, Enterprise BCM SONiC) Cumulus Linux (Limited) Arista EOS (Limited)"},{"location":"GNMI/Metrics_Data/#conclusion","title":"Conclusion","text":"<p>ONES agents designed to run on SONiC powered devices to stream network state of the switches to home grown collectors as well as 3rd party applications or collectors there by customers will be having deep visibility into their network for better troubleshooting.</p>"}]}